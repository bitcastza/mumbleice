on: [push, pull_request]
  branches:
  - master

jobs:
  docker-dev-image:
    runs-on: ubuntu-latest
    container: docker:20
    
    services:
      docker:
        image: docker:20-dind
        env:
          DOCKER_DRIVER: overlay2

    steps:
      - name: Check out repositrory code
        uses: actions/checkout@v2

      - name: Docker commands
        run: |
          - docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD $CI_REGISTRY
          - docker build --tag $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA --tag $CI_REGISTRY_IMAGE:dev .
          - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
          - docker push $CI_REGISTRY_IMAGE:dev
